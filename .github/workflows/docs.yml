name: Generate Docs

on:
  pull_request

permissions:
  contents: write

concurrency:
  group: ${{ github.workflow}}-${{ github.event_name}}-${{ github.ref }}
  cancel-in-progress: ${{ github.ref !='refs/heads/main' }}


jobs:
  docs:
    name: Generate Docs
    runs-on: ubuntu-22.04
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        ref: ${{ github.event.pull_request.head.ref }}
#       token: ${{ secrets.AUTO_COMMIT_TOKEN }} #Without this token, no checks will be triggered following an automated commit
    - name: Setup Terraform-docs
      run: |
        curl -sSLo ./terraform-docs.tar.gz https://terraform-docs.io/dl/v0.16.0/terraform-docs-v0.16.0-$(uname)-amd64.tar.gz
        tar -xzf terraform-docs.tar.gz
        chmod +x terraform-docs
        mv terraform-docs /usr/local/bin/terraform-docs
    - name: Generate Docs
      run: |
        git config user.name "github-actions[bot]""
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add .
        git diff-index --quiet HEAD || git commit -m "docs: Auto update README"
        git push